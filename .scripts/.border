#!/bin/bash

SPACETYPE="$(yabai -m query --spaces --space | jq '.type')"

# If the spacetype is bsp then toggle window border, otherwise turn it off
if [ $SPACETYPE = '"bsp"' ]; then

  # find total number of windows on current space that are not floating, not sticky, not minimized, but are visible.
  TOTAL="$(yabai -m query --windows --space | jq '.[] | select(.floating==0) | select(.sticky==0) | select(.visible==1) | select(.minimized==0) | length % 23 + 1' | wc -l)"

  if pgrep -x "limelight" >/dev/null
  then
    RUNNING='1'
  else
    RUNNING='0'
  fi

  # if the total is greater than 1, set padding, else disable padding.
  if [[ $TOTAL -gt 1 ]]; then
    if [[ $RUNNING -eq '0' ]]; then
      limelight -c ~/.limelightrc
    fi
  else
    if [[ $RUNNING -eq '1' ]]; then
      killall limelight &> /dev/null
    fi
  fi

else
  if [[ $RUNNING -eq '1' ]]; then
    killall limelight &> /dev/null
  fi
fi
